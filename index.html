<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>MR KPI TEST</title>

		<script type="text/javascript" src="./json-viewer.js"></script>
		<link rel="stylesheet" type="text/css" href="./json-viewer.css">
	</head>
<body>
	<h1 style="text-decoration: underline;">KPI title</h1>
	<h2>JSON stringified value:</h2>
	<textarea style="width: 100%; min-height: 100px;"></textarea>
	<p>Choose action:</p>
	<div>
		<button type="button" class="load-json">Load JSON</button>
		<button type="button" class="collapse">Collapse to level 1</button>
		<button type="button" class="maxlvl">Show JSON to level 1</button>
	</div>
	<h2>Output:</h2>
	<div id="json"></div>
	
	<div id="kpi-form">
	
		<input type="text" placeholder="email" id="kpi-form-email"></input>
		<input type="text" placeholder="key" id="kpi-form-key"></input>
		<input type="text" placeholder="year" id="kpi-form-year"></input>
		<input type="text" placeholder="week" id="kpi-form-week"></input>
		
		<button type="button" id="kpi-form-get-points">get points</button>
		<hr/>

		<input type="text" placeholder="clientBillable" id="kpi-form-clientBillable"></input>
		<input type="text" placeholder="companyPayProject" id="kpi-form-companyPayProject"></input>
		<input type="text" placeholder="companyPayExtra" id="kpi-form-companyPayExtra"></input>
		<input type="text" placeholder="afterHour" id="kpi-form-afterHour"></input>
		<input type="text" placeholder="afterHourExtra" id="kpi-form-afterHourExtra"></input>
		<input type="text" placeholder="leave" id="kpi-form-leave"></input>
		<input type="text" placeholder="totalBillable" id="kpi-form-totalBillable"></input>
		<input type="text" placeholder="totalActualWorking" id="kpi-form-totalActualWorking"></input>
		<input type="text" placeholder="totalJiraWorking" id="kpi-form-totalJiraWorking"></input>
		<input type="text" placeholder="fullAttendanceDay" id="kpi-form-fullAttendanceDay"></input>
		<input type="text" placeholder="logTimeDaily(1 or 0)" id="kpi-form-logTimeDaily"></input>
		<input type="text" placeholder="planTimeDaily(0.5 or 0)" id="kpi-form-planTimeDaily"></input>
		<input type="text" placeholder="demoTopic" id="kpi-form-demoTopic"></input>
		<input type="text" placeholder="sharingTopic" id="kpi-form-sharingTopic"></input>

		<button type="button" id="kpi-form-set-hours">set hours</button>
		<hr/>

		(helpVoteRecord or shareVoteRecord)
		<input type="text" placeholder="voteType" id="kpi-form-voteType"></input>
		<input type="text" placeholder="voteFor" id="kpi-form-voteFor"></input>
		<input type="text" placeholder="votePoint" id="kpi-form-votePoint"></input>
		<input type="text" placeholder="voteReason" id="kpi-form-voteReason"></input>

		<button type="button" id="kpi-form-set-vote">set hours</button>
		<hr/>
	
	</div>

	<script>
		function getBasicInfo(){
			var kpiEmail = document.querySelector("#kpi-form-email").value;
			var kpiKey = document.querySelector("#kpi-form-key").value;
			var kpiYear = document.querySelector("#kpi-form-year").value;
			var kpiWeek = document.querySelector("#kpi-form-week").value;
			
			return {
				"email": kpiEmail,
				"key": kpiKey,
				"year": kpiYear,
				"week": kpiWeek
			}
		}
		
		function getHoursInfo(){
			var clientBillable = document.querySelector("#kpi-form-clientBillable").value;
			var companyPayProject = document.querySelector("#kpi-form-companyPayProject").value;
			var companyPayExtra = document.querySelector("#kpi-form-companyPayExtra").value;
			var afterHour = document.querySelector("#kpi-form-afterHour").value;
			
			var afterHourExtra = document.querySelector("#kpi-form-afterHourExtra").value;
			var leave = document.querySelector("#kpi-form-leave").value;
			var totalBillable = document.querySelector("#kpi-form-totalBillable").value;
			var totalActualWorking = document.querySelector("#kpi-form-totalActualWorking").value;
			
			var totalJiraWorking = document.querySelector("#kpi-form-totalJiraWorking").value;
			var fullAttendanceDay = document.querySelector("#kpi-form-fullAttendanceDay").value;
			var logTimeDaily = document.querySelector("#kpi-form-logTimeDaily").value;
			var planTimeDaily = document.querySelector("#kpi-form-planTimeDaily").value;
			
			var demoTopic = document.querySelector("#kpi-form-demoTopic").value;
			var sharingTopic = document.querySelector("#kpi-form-sharingTopic").value;
			
			return {"hoursInfo": {
				"clientBillable": clientBillable,
				"companyPayProject": companyPayProject,
				"companyPayExtra": companyPayExtra,
				"afterHour": afterHour,
				
				"afterHourExtra": afterHourExtra,
				"leave": leave,
				"totalBillable": totalBillable,
				"totalActualWorking": totalActualWorking,
				
				"totalJiraWorking": totalJiraWorking,
				"fullAttendanceDay": fullAttendanceDay,
				"logTimeDaily": logTimeDaily,
				"planTimeDaily": planTimeDaily,
				
				"demoTopic": demoTopic,
				"sharingTopic": sharingTopic
			}}
		}
		
		function getVoteInfo(){
			var voteType = document.querySelector("#kpi-form-voteType").value;
			var voteFor = document.querySelector("#kpi-form-voteFor").value;
			var votePoint = document.querySelector("#kpi-form-votePoint").value;
			var voteReason = document.querySelector("#kpi-form-voteReason").value;
			
			return {"voteInfo": {
				"voteType": voteType,
				"voteFor": voteFor,
				"votePoint": votePoint,
				"voteReason": voteReason
			}}
		}
		
		document.querySelector('#kpi-form-get-points').addEventListener('click', function(){
			console.log(getBasicInfo());
			
			var url = new URL('http://mrkpi.icu/getpoints/');

			var params = getBasicInfo();

			url.search = new URLSearchParams(params).toString();
			
			var textarea = document.querySelector("textarea");
			textarea.value = JSON.stringify(fetch(url))
		}, false);
		
		
	</script>

	<script>
		var jsonObj = {};
		var jsonViewer = new JSONViewer();
		document.querySelector("#json").appendChild(jsonViewer.getContainer());

		var textarea = document.querySelector("textarea");
		textarea.value = JSON.stringify({
			key1: "<script>alert('no xss!')<\/script>",
			key2: 12345,
			key3: new Date(),
			key4: [],
			key5: [
				123,
				"123",
				{
					a: 5,
					b: 6,
					c: null,
					d: true
				}
			],
			key6: {
				a: 1,
				b: 3,
				c: {
					d: 4
				}
			}
		});

		// textarea value to JSON object
		var setJSON = function() {
			try {
				var value = textarea.value;
				jsonObj = JSON.parse(value);
			}
			catch (err) {
				alert(err);
			}
		};

		// load default value
		setJSON();

		var loadJsonBtn = document.querySelector("button.load-json");
		var collapseBtn = document.querySelector("button.collapse");
		var maxlvlBtn = document.querySelector("button.maxlvl");

		loadJsonBtn.addEventListener("click", function() {
			setJSON();
			jsonViewer.showJSON(jsonObj);
		});

		collapseBtn.addEventListener("click", function() {
			jsonViewer.showJSON(jsonObj, null, 1);
		});

		maxlvlBtn.addEventListener("click", function() {
			jsonViewer.showJSON(jsonObj, 1);
		});
	</script>
	</body>
</html>
